# -*- coding: utf-8 -*-
"""Pyramid event hooks

This is used for defining hooks onto different pyramid events.
You can get more information on events in the
:ref:`Pyramid documentation <pyramid:events_chapter>`
"""
from __future__ import absolute_import

import warnings

from pyramid.events import subscriber
from pyramid.events import ApplicationCreated


class UndefiniedRouteWarning(UserWarning):
    pass


@subscriber(ApplicationCreated)
def on_application_created_check_routes(event):
    """This function is run when ``.create_wsgi_app`` is run

    This digs into the machinery of how Pyramid works and finds the
    view callable associated with each currently defined route.

    If one is not defined, it will raise a warning. This can
    be turned into an error by using the ``-W`` flag on python.
    """
    registry = event.app.registry
    introspector = registry.introspector
    for route in introspector.get_category('routes'):
        route_introspectable = route['introspectable']
        related_introspectables = route['related']
        for related_introspectable in related_introspectables:
            if related_introspectable.category_name == 'views':
                break
        else:
            warnings.warn("Route %s does not have a view callable defined." % (
                route_introspectable.title), UndefiniedRouteWarning)
