from testify import run, assert_equal
from yelp_conn.mysql.create import column
from yelp_conn.mysql.create import create_table
from yelp_conn.mysql.create import primary_key
from yelp_conn.mysql.create import index
from yelp_conn.mysql.create import unique_index
from yelp_conn.mysql.show import show_columns
from yelp_conn.mysql.show import show_table_status
from yelp_conn.mysql.show import show_tables
from yelp_conn.testing.mysql_test_case import MySQLTestCase


class TestCreateTable(MySQLTestCase):

    def test_we_can_see_newly_created_table(self):
        create_table(self.cursor, 'foo', column('x', 'INT'))
        assert_equal(['foo'], show_tables(self.cursor))
        assert_equal(['x'], [c['Field'] for c in show_columns(self.cursor, 'foo')])

    def test_engine(self):
        create_table(self.cursor, 'inno', column('x', 'INT'), engine='InnoDB')
        assert_equal('InnoDB', show_table_status(self.cursor, 'inno')['Engine'])

    def test_create_like(self):
        columns = [column('id', 'INT', null=False),
                   column('first_name', 'VARCHAR(255)'),
                   column('last_name', 'VARCHAR(255)')]

        indexes = [primary_key('id'),
                   index('first_name'),
                   unique_index('last_name', 'first_name')]

        create_table(self.cursor, 'employee',
                     *(columns + indexes))

        create_table(self.cursor, 'employee_copy', like='employee')

        self.assert_tables_have_same_column_defs('employee', 'employee_copy')
        self.assert_tables_have_same_index_defs('employee', 'employee_copy')


if __name__ == '__main__':
    run()

