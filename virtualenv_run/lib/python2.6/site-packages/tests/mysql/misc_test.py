from testify import assert_equal, run

from yelp_conn.mysql.misc import insert_many
from yelp_conn.testing.mysql_test_case import MySQLTestCase


class TestMiscStatements(MySQLTestCase):

    def test_insert_many(self):
        self.cursor.execute('CREATE TABLE foo (id INT PRIMARY KEY AUTO_INCREMENT, x VARCHAR(10))')
        # create some duplicate rows to be inserted
        rows = [{'x': 'this'}, {'x': 'this'}, {'x': 'this'}, {'x': 'that'}]
        insert_many(self.cursor, 'foo', rows)

        # make sure all of them got inserted
        self.cursor.execute('SELECT * FROM foo')
        assert_equal(len(rows), len(self.cursor.fetchall()))

if __name__ == '__main__':
    run()
