"""Test case to use for tests that need to write some tmp files to the
filesystem; this will create a temporary directory, and delete all files inside
it when we're done. self.testing_temp_dir gives the path to this directory."""

import shutil
import tempfile

try:
    from config.config import uname as config_uname
    config_uname = config_uname # appease pyflakes
except:
    config_uname = 'test'

try:
    from config.config import temp_dir as config_temp_dir
    config_temp_dir = config_temp_dir  # appease pyflakes
except:
    # let tempfile.mkdtemp() choose one
    config_temp_dir = None

from testify import TestCase, setup, teardown


class TempDirTestCase(TestCase):
    __test__ = False

    @setup
    def _fixtures(self):
        """Create a temporary directory, and put its path in
        self.testing_temp_dir"""
        self.testing_temp_dir = tempfile.mkdtemp(prefix='__testing__%s__' % config_uname, dir=config_temp_dir)

    @teardown
    def _teardown(self):
        """Delete the temporary directory and everything in it"""
        # delete everything in the temp directory
        shutil.rmtree(self.testing_temp_dir)
        del self.testing_temp_dir # done with this variable
