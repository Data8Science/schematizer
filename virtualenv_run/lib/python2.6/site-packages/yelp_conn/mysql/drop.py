"""Utilities for dropping tables."""

from yelp_conn.mysql.show import show_tables


def drop_table(cursor, tbl_name):
    """Drop the table by the given name; raise an exception if it doesn't
    exist.

    """
    sql = 'DROP TABLE `%s`' % (tbl_name,)
    cursor.execute(sql)

def drop_table_if_exists(cursor, tbl_name):
    """Drop the table by the given name. Return True if we dropped a table,
    False otherwise.

    We actually use a SHOW TABLES statement; we can't use an actual
    DROP TABLE IF EXISTS because it creates a warning if there is no table
    See Ticket #6962
    """
    if tbl_name in show_tables(cursor):
        drop_table(cursor, tbl_name)
        return True
    else:
        return False

def drop_database(cursor, db_name):
    """Drop the given database, and all tables inside it."""
    # safeguard against accidentally deleting one of our main databases
    # DO NOT WRITE TESTS TO CHECK IF THIS SAFEGUARD IS IN PLACE
    if db_name.startswith('yelp') or db_name == 'information_schema':
        raise ValueError('Dropping database %r is not allowed!' % (db_name,))

    sql = 'DROP DATABASE `%s`' % (db_name,)
    cursor.execute(sql)
