# Schematizer


What is it?
-----------
The Schematizer is a schema store service that tracks and manages all the schemas 
used in the Data Pipeline and provides features like automatic documentation support.
We use Apache Avro to represent our schemas.

[Read More](https://engineeringblog.yelp.com/2016/08/more-than-just-a-schema-store.html)


How to download
---------------
```
git clone git@github.com:Yelp/schematizer.git
```


Tests
-----
Running unit tests
```
make -f Makefile-opensource test
```

Running unit integration tests
```
make -f Makefile-opensource itest
```


Setup and Configuration
-----------------------
Create a mysql database for Schematizer Service::
```
CREATE DATABASE <db_name> DEFAULT CHARACTER SET utf8;
```

Create a mysql tables in `<db_name>` database for Schematizer Service::
```
cat schema/tables/*.sql | mysql <db_name>
```

Create a `topology.yaml` file
```
topology:
-   cluster: <schematizer_cluster_name>
    replica: master
    entries:
        - charset: utf8
          use_unicode: true
          host: <db_ip>
          db: <db_name>
          user: <db_user>
          passwd: <db_password>
          port: <db_port>
```

In `config.yaml` assign values to following configs::
```
schematizer_cluster: <schematizer_cluster_name>

topology_path: /path/to/topology.yaml
```


Usage
-----
Use `serviceinitd/schematizer.py` to start schematizer service.

Registering a schema with schematizer::
```
curl -X POST --header 'Content-Type: application/json' --header 'Accept: text/plain' -d '{
  "namespace": "test_namespace",
  "source_owner_email": "test@test.com",
  "source": "test_source",
  "contains_pii": false,
  "schema": "{\n   \"type\":\"record\",\n   \"namespace\":\"test_namespace\",\n   \"source\":\"test_source\",\n   \"name\":\"test_name\",\n   \"doc\":\"test_doc\",\n   \"fields\":[\n      {\n         \"type\":\"string\",\n         \"doc\":\"test_doc1\",\n         \"name\":\"key1\"\n      },\n      {\n         \"type\":\"string\",\n         \"doc\":\"test_doc2\",\n         \"name\":\"key2\"\n      }\n   ]\n}"
}' 'http://127.0.0.1:8888/v1/schemas/avro'
```

Getting Schema By ID from schematizer::
```
curl -X GET --header 'Accept: text/plain' 'http://127.0.0.1:8888/v1/schemas/<schema_id>'
```


License
-------
Schematizer is licensed under the Apache License, Version 2.0: http://www.apache.org/licenses/LICENSE-2.0


Contributing
------------
Everyone is encouraged to contribute to Schematizer by forking the Github repository and making a pull request or opening an issue.
